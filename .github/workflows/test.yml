name: Push to Gitee via HTTP Header

on:
  workflow_dispatch:

jobs:
  push:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Show Git info
        run: |
          echo "=== 当前分支状态 ==="
          git branch -a
          git status
          echo "=== 最近提交 ==="
          git log -3 --oneline

      - name: Add Gitee remote
        run: |
          echo "=== 添加 Gitee 远程仓库 ==="
          git remote add gitee https://gitee.com/yvor_liu/tvbox.git
          git remote -v

      - name: Push to Gitee (main -> master)
        run: |
          echo "=== 开始推送到 Gitee ==="
          # 用 http.extraHeader 强制带 Token，避免交互式认证
          GIT_TERMINAL_PROMPT=0 git -c http.extraHeader="Authorization: token 321e50c481fc252d4b5dab71bfb1aa45" push gitee HEAD:master --force
